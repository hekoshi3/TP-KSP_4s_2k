

# Ставим нейросеть и запускаем её локально

В общем, если у вас есть желание использовать сайт с настоящей генерацией изображений, а не просто какими-то там всякими уже заготовленными (только одним), то я подготовил для вас небольшую инструкцию, как можно развернуть нейросеть у себя на компе. Важно помнить, что ваш компьютер может быть слишком слабым или просто не подходить под минимальные требования для того чтобы нейросеть работала исправно, но в целом попробовать можно.
Важно: лучше всего нейросеть работает на видеокарте в имеющимися в ней CUDA-ядрами, поэтому будет хорошо если у вас какая-нибудь RTX, но я думаю что всякие GTX1050 тоже вполне подоёдут, просто будет медленно и комп может сильно нагружаться. Также, нейросети очень требовательны к оперативной памяти, поэтому будьте уверены что у вас хотя бы 8гб.
AMD видеокарты работают но с болью в одном месте, я писать инструкцию на это не буду. Не работает с АМД короче.

## Инструкция по установке нейросети генерации изображений на свой комп:
###### Подготовка Python

Прежде всего стоит убедиться, что у вас стоит правильная версия Python. То, что мы будем ставить, работает ***ТОЛЬКО*** с версией 3.10.6. Проверить: открываем CMD (Win+R -> cmd -> 'python --version'). Возможно, что у вас может выдать ошибку, поэтому вместо 'python'  в консоли можно ввести 'py -3 --version', и скорее всего вы увидите другую версию, которая не нужна.

В идеале - снести питон полностью и поставить его заново [отсюда](https://www.python.org/downloads/release/python-3106/). Но есть более интересные решения, которые я приводить не буду, вместо этого мы будем страдать и прописывать пути.
Итак, условимся, что у нас либо питон 3.10.6, либо любой другой питон, не нужной нам версии. Если у нас первый случай, пропускаем следующий блок. Если второй случай: 
   - Устанавливаем [Python 3.10.6](https://www.python.org/downloads/release/python-3106/), запоминаем папку и в идеале копируем и сохраняем путь до неё куда-нибудь. Все, дальше идём к пункту 2.

###### Ставим нейросеть

У нас нормальная или не совсем нормальная версия Python, теперь нам нужно установить интерфейс и скачать модель. В идеале сделать все сразу и вместе, потому что интерфейс будет качать свою модель и это будет занимать много времени.
  - Идём на страницу интерфейса https://github.com/AUTOMATIC1111/stable-diffusion-webui, и ставим. Никто не мешает вам скачать архивом и использовать, но чтобы не париться с обновлениями, желательно гитнуть репозиторий. Можно использовать GitHub Desktop, а можно 'cmd>>git clone', кому как удобнее. Главное не коммитить свои изменения и не создавать форки.
  - Гитнули репозиторий, качаем модель. Есть сайт, который позволяет найти любую модель для любой ситуации, там ещё есть и лоры всякие и все такое, но можно использовать и Hugging Face. Но я все же рекомендую civitai.com, самый большой и удобный сборник всего. Переходим на civitai.com, жмём на вкладку Models и выбираем модели. К сожалению, если вы будете использовать модели, которые не доступны в нашей БД, вам придётся самому добавлять её туда, поэтому вот ссылки на пару моделей, они весят немного:
     - [CetusMixWhalefall](https://civitai.com/models/6755/cetus-mix) (3.60GB)
     - [Counterfeit V2.5](https://civitai.com/models/4468?modelVersionId=7425) (3.97GB)
  - Модели нужно расположить в папке '...\stable-diffusion-webui\models\Stable-diffusion'
  - Перед запуском, если у вас все нормально по версии Python, пропустите этот шаг. Если версия не 3.10.6, но вы её уже поставили, сделайте следующее:
      - Заходим в папку репозитория, докапываемся до webui-user.bat. Открываем его хоть просто блокнотом, и в строчке 'set PYTHON=' ставим полный путь до нашего python.exe из папки, которую мы сохраняли в пункте 1.1. Теперь при первом запуске все будет работать по этому пути и использовать питон нужной нам версии.
  - У нас все клонировано и скачано, Python нужной версии. Теперь можно приступить к первому запуску. Обычно он самый долгий и сложный, и именно на нём случаются все проблемы. Запускаем webui-user.bat, и молимся чтобы все поставилось правильно. Это будет долго, потому что файлы для установки большие.
  - После того, как все поставится, все запустится, лучше закрыть консоль и сделать следующее:
     - Снова докапываемся до webui-user.bat. В поле версии Python ставим путь до python.exe папки venv (у меня это выглядит так: 'set PYTHON=C:\AI\texttoimage\stable-diffusion-webui\venv\Scripts\python.exe'), а в поле аргументов запуска ставим следующее: 'COMMANDLINE_ARGS=--xformers --listen --api'

   После описанных выше действий, в файле API SDGEN.py убеждаемся, что адрес подключения в верхних строках действительно 'localhost' или '127.0.0.1', а в файле views.py метод указан не тестовый, а рабочий (название метода без приписки '_TEST').
   Теперь можно запустить нейросеть через webui-user.bat, и открыть сервер Django. Если все прошло успешно, все будет работать как должно.
   По всем вопросам в чат, в лс или в 'Issues' на странице проекта
